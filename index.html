<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="The package is designed to facilitate querying data from the ‘Facebook Marketing’ API, particularly for social science research &lt;[https://developers.facebook.com/docs/marketing-apis/]https://developers.facebook.com/docs/marketing-apis/&gt;. Facebook marketing data has been used for a variety of social science applications, such as for poverty estimation (Marty and Duhaut (2024) &lt;https://doi.org/10.1038/s41598-023-49564-6&gt;), disease surveillance (Araujo et al. (2017) &lt;arXiv:1705.04045&gt;), and measuring migration (Alexander, Polimis, and Zagheni (2020) &lt;https://doi.org/10.1007/s11113-020-09599-3&gt;). The package facilitates querying the number of Facebook active users for multiple location types (e.g., from around a specific coordinate to an administrative region) and for a number of attribute types (e.g., interests, behaviors, education level, etc). The package supports making complex queries with multiple AND and OR conditions.">
<title>Facebook Marketing API Social Watcher • rsocialwatcher</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Facebook Marketing API Social Watcher">
<meta property="og:description" content="The package is designed to facilitate querying data from the ‘Facebook Marketing’ API, particularly for social science research &lt;[https://developers.facebook.com/docs/marketing-apis/]https://developers.facebook.com/docs/marketing-apis/&gt;. Facebook marketing data has been used for a variety of social science applications, such as for poverty estimation (Marty and Duhaut (2024) &lt;https://doi.org/10.1038/s41598-023-49564-6&gt;), disease surveillance (Araujo et al. (2017) &lt;arXiv:1705.04045&gt;), and measuring migration (Alexander, Polimis, and Zagheni (2020) &lt;https://doi.org/10.1007/s11113-020-09599-3&gt;). The package facilitates querying the number of Facebook active users for multiple location types (e.g., from around a specific coordinate to an administrative region) and for a number of attribute types (e.g., interests, behaviors, education level, etc). The package supports making complex queries with multiple AND and OR conditions.">
<meta property="og:image" content="https://worldbank.github.io/rsocialwatcher/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">rsocialwatcher</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/create_facebook_credentials.html">Create Facebook Credentials: Token, Version, &amp; Creation Act</a>
    <a class="dropdown-item" href="articles/example-pop-gdp-gender.html">Example: Facebook Usage, Population Online, GDP, &amp; Gender in Africa</a>
    <a class="dropdown-item" href="articles/rsocialwatcher-vignette.html">rsocialwatcher: Usage Examples</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/worldbank/rsocialwatcher/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="rsocialwatcher-">rsocialwatcher <a class="anchor" aria-label="anchor" href="#rsocialwatcher-"></a>
</h1>
</div>
<p>Query data from the Facebook Marketing API using R, with a focus for social science research.</p>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#credentials">Credentials</a></li>
<li><a href="#quick">Quick Start</a></li>
<li><a href="#usage">Usage</a></li>
</ul>
<div class="section level2">
<h2 id="overview-">Overview <a name="overview"></a>
<a class="anchor" aria-label="anchor" href="#overview-"></a>
</h2>
<p>This package facilitates querying data from the Facebook Marketing API. The packages is inspired by <a href="https://github.com/maraujo/pySocialWatcher" class="external-link">pySocialWatcher</a>, which is a similar package built for Python. Emerging research has shown that the Facebook Marketing API can provide useful data for social science research. For example, Facebook marketing data has been used for:</p>
<ul>
<li>Poverty estimation (<a href="https://ojs.aaai.org//index.php/ICWSM/article/view/7361" class="external-link">here</a> and <a href="https://www.nature.com/articles/s41598-023-49564-6" class="external-link">here</a>)</li>
<li><a href="https://arxiv.org/abs/1705.04045" class="external-link">Disease surveillance</a></li>
<li>Migrants in United States (<a href="https://link.springer.com/article/10.1007/s11113-020-09599-3" class="external-link">here</a> and <a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/padr.12102" class="external-link">here</a>)</li>
<li><a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0229175" class="external-link">Monitoring refugee and migrant flows in Venezuela</a></li>
<li><a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0224134" class="external-link">Quantifying mobility patterns</a></li>
<li><a href="https://arxiv.org/pdf/2002.11645.pdf" class="external-link">Studying the Urban/Rural Divide</a></li>
</ul>
<p>The package provides the following functions:</p>
<ul>
<li>
<a href="https://worldbank.github.io/rsocialwatcher/reference/get_fb_parameter_ids.html"><code>get_fb_parameter_ids()</code></a>: To obtain IDs for targeting users by different characteristics, including (1) different parameter types (eg, behaviors and interests) and (2) location keys (eg, city keys)</li>
<li>
<a href="https://worldbank.github.io/rsocialwatcher/reference/get_location_coords.html"><code>get_location_coords()</code></a>: To obtain coordinates and, when available, geometries of locations based on their location keys.</li>
<li>
<a href="https://worldbank.github.io/rsocialwatcher/reference/query_fb_marketing_api.html"><code>query_fb_marketing_api()</code></a>: Query daily and monthly active users, querying users for specific locations and by specific types.</li>
<li>
<a href="https://worldbank.github.io/rsocialwatcher/reference/get_fb_suggested_radius.html"><code>get_fb_suggested_radius()</code></a>: Determine a suggested radius to reach enough people for a given coordinate pair.</li>
</ul>
</div>
<div class="section level2">
<h2 id="installation-">Installation <a name="installation"></a>
<a class="anchor" aria-label="anchor" href="#installation-"></a>
</h2>
<p>The package is available via Github and can be install using <code>devtools</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"worldbank/rsocialwatcher"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="facebook-api-credentials-">Facebook API Credentials <a name="credentials"></a>
<a class="anchor" aria-label="anchor" href="#facebook-api-credentials-"></a>
</h2>
<p>Using the Facebook Marketing API requires indicating the following:</p>
<ol style="list-style-type: decimal">
<li>Token</li>
<li>Version</li>
<li>Creation</li>
</ol>
<p>Follow the instructions <a href="https://worldbank.github.io/rsocialwatcher/articles/create_facebook_credentials.html">here</a> to obtain these credentials.</p>
</div>
<div class="section level2">
<h2 id="quickstart-">Quickstart <a name="quick"></a>
<a class="anchor" aria-label="anchor" href="#quickstart-"></a>
</h2>
<ul>
<li><a href="#quick-setup">Setup</a></li>
<li><a href="#quick-param-id">Get Facebook Parameter IDs</a></li>
<li><a href="#quick-location">Query Facebook Users for Different Location Types</a></li>
<li><a href="#quick-attributes">Query Facebook Users by Different Attributes</a></li>
<li><a href="#quick-multiple">Map Over Multiple Queries</a></li>
</ul>
<div class="section level3">
<h3 id="setup-">Setup <a name="quick-setup"></a>
<a class="anchor" aria-label="anchor" href="#setup-"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://worldbank.github.io/rsocialwatcher/">rsocialwatcher</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define API version, creation act &amp; token -------------------------------------</span></span>
<span><span class="va">VERSION</span>      <span class="op">&lt;-</span> <span class="st">"[ENTER HERE]"</span> <span class="co"># Example: "v19.0"</span></span>
<span><span class="va">CREATION_ACT</span> <span class="op">&lt;-</span> <span class="st">"[ENTER HERE]"</span></span>
<span><span class="va">TOKEN</span>        <span class="op">&lt;-</span> <span class="st">"[ENTER HERE]"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="get-dataframes-of-select-parameter-ids-">Get dataframes of select parameter IDs <a name="quick-param-id"></a>
<a class="anchor" aria-label="anchor" href="#get-dataframes-of-select-parameter-ids-"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get dataframe of Facebook parameter IDs and descriptions ---------------------</span></span>
<span><span class="co">## Interests and behaviors</span></span>
<span><span class="va">interests_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_fb_parameter_ids.html">get_fb_parameter_ids</a></span><span class="op">(</span><span class="st">"interests"</span>, <span class="va">VERSION</span>, <span class="va">TOKEN</span><span class="op">)</span></span>
<span><span class="va">behaviors_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_fb_parameter_ids.html">get_fb_parameter_ids</a></span><span class="op">(</span><span class="st">"behaviors"</span>, <span class="va">VERSION</span>, <span class="va">TOKEN</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Locations: countries</span></span>
<span><span class="va">country_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_fb_parameter_ids.html">get_fb_parameter_ids</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="va">VERSION</span>, <span class="va">TOKEN</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="query-data-for-different-location-types-">Query data for different location types <a name="quick-location"></a>
<a class="anchor" aria-label="anchor" href="#query-data-for-different-location-types-"></a>
</h3>
<p><strong>Example:</strong> Query Facebook users in US</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">us_key</span> <span class="op">&lt;-</span> <span class="va">country_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"United States"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">key</span><span class="op">)</span></span>
<span></span>
<span><span class="va">us_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/query_fb_marketing_api.html">query_fb_marketing_api</a></span><span class="op">(</span></span>
<span>  location_unit_type <span class="op">=</span> <span class="st">"countries"</span>,</span>
<span>  location_keys      <span class="op">=</span> <span class="va">us_key</span>,</span>
<span>  version            <span class="op">=</span> <span class="va">VERSION</span>, </span>
<span>  creation_act       <span class="op">=</span> <span class="va">CREATION_ACT</span>, </span>
<span>  token              <span class="op">=</span> <span class="va">TOKEN</span><span class="op">)</span></span></code></pre></div>
<p><strong>Example:</strong> Query Facebook users around specific location</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">latlon_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/query_fb_marketing_api.html">query_fb_marketing_api</a></span><span class="op">(</span></span>
<span>  location_unit_type <span class="op">=</span> <span class="st">"coordinates"</span>,</span>
<span>  lat_lon            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40.712</span>, <span class="op">-</span><span class="fl">74.006</span><span class="op">)</span>,</span>
<span>  radius             <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  radius_unit        <span class="op">=</span> <span class="st">"kilometer"</span>,</span>
<span>  version            <span class="op">=</span> <span class="va">VERSION</span>, </span>
<span>  creation_act       <span class="op">=</span> <span class="va">CREATION_ACT</span>, </span>
<span>  token              <span class="op">=</span> <span class="va">TOKEN</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="obtain-location-coordinatesgeometries-">Obtain location coordinates/geometries <a name="quick-location"></a>
<a class="anchor" aria-label="anchor" href="#obtain-location-coordinatesgeometries-"></a>
</h3>
<p><strong>Example:</strong> Location coordinates and, when available, geometries can be obtained using the <code>get_location_coords</code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">countries_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_location_coords.html">get_location_coords</a></span><span class="op">(</span></span>
<span>  location_unit_type <span class="op">=</span> <span class="st">"countries"</span>,</span>
<span>  location_keys      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"US"</span>, <span class="st">"MX"</span>, <span class="st">"CA"</span><span class="op">)</span>,</span>
<span>  version            <span class="op">=</span> <span class="va">VERSION</span>,</span>
<span>  token              <span class="op">=</span> <span class="va">TOKEN</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Example:</strong> In addition, when obtaining location IDs using the <code>query_fb_marketing_api</code> function, we can directly add coordinates/geometries by setting the <code>add_location_coords</code> to <code>TRUE</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">us_states_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_fb_parameter_ids.html">get_fb_parameter_ids</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"region"</span>, </span>
<span>  country_code <span class="op">=</span> <span class="st">"US"</span>, </span>
<span>  version <span class="op">=</span> <span class="va">VERSION</span>, </span>
<span>  token <span class="op">=</span> <span class="va">TOKEN</span>,</span>
<span>  add_location_coords <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="get-suggested-radius">Get suggested radius<a class="anchor" aria-label="anchor" href="#get-suggested-radius"></a>
</h3>
<p>Facebook enables querying a specific location to determine a suggested radius to reach enough people (see <a href="https://developers.facebook.com/docs/marketing-api/audiences/reference/targeting-search/#radius" class="external-link">Facebook documentation here</a>). We can use the <code>get_fb_suggested_radius</code> function to get the suggested radius. Below shows the querying the suggested radius for Paris, France and Paris, Kentucky.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Paris, France</span></span>
<span><span class="fu"><a href="reference/get_fb_suggested_radius.html">get_fb_suggested_radius</a></span><span class="op">(</span>location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">48.856667</span>, <span class="fl">2.352222</span><span class="op">)</span>,</span>
<span>                        version <span class="op">=</span> <span class="va">VERSION</span>,</span>
<span>                        token <span class="op">=</span> <span class="va">TOKEN</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Paris, Kentucky</span></span>
<span><span class="fu"><a href="reference/get_fb_suggested_radius.html">get_fb_suggested_radius</a></span><span class="op">(</span>location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">38.209682</span>, <span class="op">-</span><span class="fl">84.253915</span><span class="op">)</span>,</span>
<span>                        version <span class="op">=</span> <span class="va">VERSION</span>,</span>
<span>                        token <span class="op">=</span> <span class="va">TOKEN</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="query-data-for-different-user-attributes-">Query data for different user attributes <a name="quick-attributes"></a>
<a class="anchor" aria-label="anchor" href="#query-data-for-different-user-attributes-"></a>
</h3>
<p><strong>Example [One parameter]:</strong> Facebook users who primarily access Facebook using Mac OS X living in the US</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beh_mac_id</span> <span class="op">&lt;-</span> <span class="va">behaviors_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Facebook access (OS): Mac OS X"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">us_mac_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/query_fb_marketing_api.html">query_fb_marketing_api</a></span><span class="op">(</span></span>
<span>  location_unit_type <span class="op">=</span> <span class="st">"country"</span>,</span>
<span>  location_keys      <span class="op">=</span> <span class="st">"US"</span>,</span>
<span>  behaviors          <span class="op">=</span> <span class="va">beh_mac_id</span>,</span>
<span>  version            <span class="op">=</span> <span class="va">VERSION</span>,</span>
<span>  creation_act       <span class="op">=</span> <span class="va">CREATION_ACT</span>,</span>
<span>  token              <span class="op">=</span> <span class="va">TOKEN</span><span class="op">)</span></span></code></pre></div>
<p><strong>Example [Two parameters, OR condition]:</strong> Facebook users who primarily access Facebook using Mac OS X OR who are likely technology early adopters who live in the US. <em>Vectors of IDs are used to specify OR conditions.</em></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beh_tech_id</span> <span class="op">&lt;-</span> <span class="va">behaviors_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Technology early adopters"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">us_mac_or_tech_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/query_fb_marketing_api.html">query_fb_marketing_api</a></span><span class="op">(</span></span>
<span>  location_unit_type <span class="op">=</span> <span class="st">"country"</span>,</span>
<span>  location_keys      <span class="op">=</span> <span class="st">"US"</span>,</span>
<span>  behaviors          <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">beh_mac_id</span>, <span class="va">beh_tech_id</span><span class="op">)</span>,</span>
<span>  version            <span class="op">=</span> <span class="va">VERSION</span>,</span>
<span>  creation_act       <span class="op">=</span> <span class="va">CREATION_ACT</span>,</span>
<span>  token              <span class="op">=</span> <span class="va">TOKEN</span><span class="op">)</span></span></code></pre></div>
<p><strong>Example [Two parameters, AND condition]:</strong> Facebook users who primarily access Facebook using Mac OS X AND who are likely technology early adopters who live in the US. <em>Lists of IDs are used to specify AND conditions.</em></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">us_mac_and_tech_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/query_fb_marketing_api.html">query_fb_marketing_api</a></span><span class="op">(</span></span>
<span>  location_unit_type <span class="op">=</span> <span class="st">"country"</span>,</span>
<span>  location_keys      <span class="op">=</span> <span class="st">"US"</span>,</span>
<span>  behaviors          <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">beh_mac_id</span>, <span class="va">beh_tech_id</span><span class="op">)</span>,</span>
<span>  version            <span class="op">=</span> <span class="va">VERSION</span>,</span>
<span>  creation_act       <span class="op">=</span> <span class="va">CREATION_ACT</span>,</span>
<span>  token              <span class="op">=</span> <span class="va">TOKEN</span><span class="op">)</span></span></code></pre></div>
<p><strong>Example [Two parameters, OR and AND condition]:</strong> Facebook users who (primarily access Facebook using Mac OS X AND who are likely technology early adopters) OR are interested in computers, who live in the US. Multiple parameters (eg, behavior and interests) are grouped using OR conditions by default. <strong>The “flex_target” parameters can be used to specify AND conditions across parameters; see <a href="https://worldbank.github.io/rsocialwatcher/articles/rsocialwatcher-vignette.html#across-parameter-types-flexible-targetting">here</a> for examples.</strong></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>int_comp_id <span class="ot">&lt;-</span> interests_df <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"Computers (computers &amp; electronics))"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="fu">pull</span>(id)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>us_mac_and_tech_or_comp_df <span class="ot">&lt;-</span> <span class="fu">query_fb_marketing_api</span>(</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>  <span class="at">location_unit_type =</span> <span class="st">"country"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>  <span class="at">location_keys      =</span> <span class="st">"US"</span>,</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>  <span class="at">behaviors          =</span> <span class="fu">list</span>(beh_mac_id, beh_tech_id),</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>  <span class="at">interests          =</span> int_comp_id</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>  <span class="at">version            =</span> VERSION,</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>  <span class="at">creation_act       =</span> CREATION_ACT,</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>  <span class="at">token              =</span> TOKEN)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="map-over-multiple-queries-">Map Over Multiple Queries <a name="quick-multiple"></a>
<a class="anchor" aria-label="anchor" href="#map-over-multiple-queries-"></a>
</h3>
<p>Putting parameters in the <code>map_param</code> function results in the <code>query_fb_marketing_api</code> function making multiple queries.</p>
<p><strong>Example:</strong> Make queries for different countries.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>country_df <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"United States"</span>, <span class="st">"Canada"</span>, <span class="st">"Mexico"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  <span class="fu">pull</span>(key)</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>us_mult_cnt_df <span class="ot">&lt;-</span> <span class="fu">query_fb_marketing_api</span>(</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>  <span class="at">location_unit_type =</span> <span class="st">"country"</span>,</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>  <span class="at">location_keys      =</span> <span class="fu">map_param</span>(<span class="st">"US"</span>, <span class="st">"CA"</span>, <span class="st">"MX"</span>),</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>  <span class="at">behaviors          =</span> <span class="fu">c</span>(beh_mac_id, beh_tech_id),</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>  <span class="at">interests          =</span> int_comp_id</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>  <span class="at">version            =</span> VERSION,</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>  <span class="at">creation_act       =</span> CREATION_ACT,</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>  <span class="at">token              =</span> TOKEN)</span></code></pre></div>
<p><strong>Example:</strong> Make queries for different and behaviors. In total, six queries are made (mapping over three countries and two parameters).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>us_mult_cnt_param_df <span class="ot">&lt;-</span> <span class="fu">query_fb_marketing_api</span>(</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  <span class="at">location_unit_type =</span> <span class="st">"country"</span>,</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  <span class="at">location_keys      =</span> <span class="fu">map_param</span>(<span class="st">"US"</span>, <span class="st">"CA"</span>, <span class="st">"MX"</span>),</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  <span class="at">behaviors          =</span> <span class="fu">map_param</span>(beh_mac_id, beh_tech_id),</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>  <span class="at">interests          =</span> int_comp_id</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>  <span class="at">version            =</span> VERSION,</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>  <span class="at">creation_act       =</span> CREATION_ACT,</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>  <span class="at">token              =</span> TOKEN)</span></code></pre></div>
<p><strong>Example:</strong> Make query for each country, for:</p>
<ul>
<li>Those that access Facebook using Mac OS X OR who are likely technology early adopters</li>
<li>Those that access Facebook using Mac OS X AND who are likely technology early adopters</li>
</ul>
<p>The below illustrates how we can make complex queries (ie, using AND and OR) conditions within <code><a href="reference/map_param.html">map_param()</a></code></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>us_mult_cnt_param_df <span class="ot">&lt;-</span> <span class="fu">query_fb_marketing_api</span>(</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>  <span class="at">location_unit_type =</span> <span class="st">"country"</span>,</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>  <span class="at">location_keys      =</span> <span class="fu">map_param</span>(<span class="st">"US"</span>, <span class="st">"CA"</span>, <span class="st">"MX"</span>),</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>  <span class="at">behaviors          =</span> <span class="fu">map_param</span>(<span class="fu">c</span>(beh_mac_id, beh_tech_id), <span class="co"># OR condition</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>                                 <span class="fu">list</span>(beh_mac_id, beh_tech_id)), <span class="co"># AND condition</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>  <span class="at">interests          =</span> int_comp_id</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>  <span class="at">version            =</span> VERSION,</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>  <span class="at">creation_act       =</span> CREATION_ACT,</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>  <span class="at">token              =</span> TOKEN)</span></code></pre></div>
<p><strong>Example:</strong> Make queries using vector as input. Below, we want to make a separate query for six countries. We define the following vector:</p>
<p><code>countries &lt;- c("US", "CA", "MX", "FR", "GB", "ES")</code></p>
<p>However, for the below:</p>
<p><code>location_keys = map_param(countries)</code></p>
<p><code><a href="reference/map_param.html">map_param()</a></code> views <code>countries</code> as one item (a vector of countries), so will make just 1 query—querying the number of MAU/DAU across countries. To make a query for each item in the vector, we use <code><a href="reference/map_param_vec.html">map_param_vec()</a></code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">countries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"US"</span>, <span class="st">"CA"</span>, <span class="st">"MX"</span>, <span class="st">"FR"</span>, <span class="st">"GB"</span>, <span class="st">"ES"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># INCORRECT: The below will make 1 query, querying the number of MAU/DAU across countries.</span></span>
<span><span class="va">us_mult_cnt_param_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/query_fb_marketing_api.html">query_fb_marketing_api</a></span><span class="op">(</span></span>
<span>  location_unit_type <span class="op">=</span> <span class="st">"country"</span>,</span>
<span>  location_keys      <span class="op">=</span> <span class="fu"><a href="reference/map_param.html">map_param</a></span><span class="op">(</span><span class="va">countries</span><span class="op">)</span>,</span>
<span>  version            <span class="op">=</span> <span class="va">VERSION</span>,</span>
<span>  creation_act       <span class="op">=</span> <span class="va">CREATION_ACT</span>,</span>
<span>  token              <span class="op">=</span> <span class="va">TOKEN</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># CORRECT: The below will make 6 queries, one for each country.</span></span>
<span><span class="va">us_mult_cnt_param_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/query_fb_marketing_api.html">query_fb_marketing_api</a></span><span class="op">(</span></span>
<span>  location_unit_type <span class="op">=</span> <span class="st">"country"</span>,</span>
<span>  location_keys      <span class="op">=</span> <span class="fu"><a href="reference/map_param_vec.html">map_param_vec</a></span><span class="op">(</span><span class="va">countries</span><span class="op">)</span>,</span>
<span>  version            <span class="op">=</span> <span class="va">VERSION</span>,</span>
<span>  creation_act       <span class="op">=</span> <span class="va">CREATION_ACT</span>,</span>
<span>  token              <span class="op">=</span> <span class="va">TOKEN</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-multiple-api-tokens-">Using Multiple API Tokens <a name="multiple_tokens"></a>
<a class="anchor" aria-label="anchor" href="#using-multiple-api-tokens-"></a>
</h3>
<p>The Facebook API is rate limited, where only a certain number of queries can be made in a given time. If the rate limit is reached, <code>query_fb_marketing_api</code> will pause then try the query until it is successfully called. <code>query_fb_marketing_api</code> can take a long time to complete if mapping over a large number of queries.</p>
<p>Multiple API tokens can be used to minimize delay times from the function reaching its rate limit. To use multiple tokens, enter a vector with multiple entries for <code>version</code>, <code>creation_act</code>, and <code>token</code>.</p>
<p><strong>Example:</strong> Using multiple API tokens</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>mult_queries_df <span class="ot">&lt;-</span> <span class="fu">query_fb_marketing_api</span>(</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  <span class="at">location_unit_type =</span> <span class="st">"country"</span>,</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  <span class="at">location_keys      =</span> <span class="fu">map_param</span>(<span class="st">"US"</span>, <span class="st">"CA"</span>, <span class="st">"MX"</span>, <span class="st">"GB"</span>, <span class="st">"FR"</span>, <span class="st">"DE"</span>, <span class="st">"IT"</span>),</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>  <span class="at">behaviors          =</span> <span class="fu">c</span>(beh_mac_id, beh_tech_id),</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>  <span class="at">interests          =</span> int_comp_id</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>  <span class="at">version            =</span> <span class="fu">c</span>(VERSION_1,      VERSION_2,      VERSION_3) ,</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>  <span class="at">creation_act       =</span> <span class="fu">c</span>(CREATION_ACT_1, CREATION_ACT_2, CREATION_ACT_3)</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>  <span class="at">token              =</span> <span class="fu">c</span>(TOKEN_1,        TOKEN_2,        TOKEN_3) )</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="usage-">Usage <a name="usage"></a>
<a class="anchor" aria-label="anchor" href="#usage-"></a>
</h2>
<p>See <a href="https://worldbank.github.io/rsocialwatcher/articles/rsocialwatcher-vignette.html">this vignette</a> for additional information and examples illustrating how to use the package.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/worldbank/rsocialwatcher/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/worldbank/rsocialwatcher/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing rsocialwatcher</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Robert Marty <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-3164-3813" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Robert Marty.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
